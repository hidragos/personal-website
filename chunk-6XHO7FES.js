import{a as bt,b as yt,c as Ct}from"./chunk-6K227B3A.js";import{a as vt}from"./chunk-4JM77DEA.js";import{b as ht}from"./chunk-ASZLFFAX.js";import{a as rt,b,c as _t,e as gt,l as xt}from"./chunk-S2EGJNVF.js";import"./chunk-X5YLR3NI.js";import{e as nt,l as ot,m as E,o as lt,p as at,r as ct,s as st,t as mt,u as dt,v as ut,w as pt,z as ft}from"./chunk-UTXEXKJQ.js";import{B as O,C as Q,D as $,G as J,I as W,M as X,N as Z,O as tt,P as et,Q as it}from"./chunk-DNSHJFD5.js";import"./chunk-WXI33M2S.js";import{b as q,d as U,h as Y}from"./chunk-FPD7F3TA.js";import{g as G}from"./chunk-IIQSA42B.js";import{k as z,l as H,m as P,o as K,p as L}from"./chunk-YYXHG7V6.js";import{Cb as n,Db as l,Eb as C,Hb as h,Mb as x,Ob as d,Tb as M,Ub as B,Vb as I,Wa as F,Xb as s,Yb as k,Zb as v,_a as o,_b as T,ac as V,cc as D,da as u,dc as S,fc as j,ha as w,hc as R,ra as _,sa as g,sb as p,sc as N,ub as a,yb as A}from"./chunk-5BPRXVO3.js";import{a as y,i as f}from"./chunk-ODN5LVDJ.js";var St=["editor"],Et=(e,m)=>({"opacity-100":e,"opacity-0":m}),wt=(e,m)=>({"opacity-50":e,"opacity-0":m}),Ft=e=>({"opacity-0":e});function At(e,m){if(e&1&&(n(0,"div",18)(1,"span",19),s(2),l(),n(3,"div",20)(4,"div",21)(5,"span"),s(6),l(),s(7," ~ "),n(8,"span"),s(9),j(10,"date"),l()()()()),e&2){let t,i=d(2);o(2),T(" ",i.title==null?null:i.title.value," ",i.articleForm.dirty?"*":""," "),o(4),k((t=i.article.profiles==null?null:i.article.profiles.full_name)!==null&&t!==void 0?t:i.article.profiles==null?null:i.article.profiles.email),o(3),v(" ",R(10,4,i.article.inserted_at,"longDate")," ")}}function Mt(e,m){if(e&1&&(n(0,"div",22)(1,"span",23),s(2," * "),l(),n(3,"span",24),s(4),l()()),e&2){let t,i=d(2);o(),a("ngClass",S(2,wt,i.articleForm.dirty,i.articleForm.pristine)),o(3),v(" ",(t=i.title==null||i.title.value==null?null:i.title.value.length)!==null&&t!==void 0?t:0," / 100 ")}}function Bt(e,m){if(e&1&&C(0,"editor",25),e&2){let t=d(2);a("ngClass",D(3,Ft,!t.editorInitialized))("apiKey",t.editorApiKey)("init",t.init)}}function It(e,m){if(e&1&&C(0,"div",26,1),e&2){let t=d(2);a("innerHTML",t.article.contentSafeHtml,F)}}function kt(e,m){if(e&1){let t=h();n(0,"button",33),x("click",function(){_(t);let c=d(3);return g(c.onDelete())}),s(1," Delete "),l()}}function Tt(e,m){if(e&1){let t=h();n(0,"button",34),x("click",function(){_(t);let c=d(3);return g(c.onRestore())}),s(1," Restore "),l()}if(e&2){let t=d(3);a("disabled",t.articleForm.pristine)}}function Vt(e,m){if(e&1){let t=h();n(0,"div",15)(1,"div",27),p(2,kt,2,0,"button",28)(3,Tt,2,1,"button",29),l(),n(4,"div",30)(5,"button",31),x("click",function(){_(t);let c=d(2);return g(c.toggleEdit())}),s(6," Preview "),l(),n(7,"button",32),s(8," Save "),l()()()}if(e&2){let t=d(2);o(2),a("ngIf",t.id),o(),a("ngIf",t.id),o(4),a("disabled",t.articleForm.pristine)}}function Dt(e,m){if(e&1){let t=h();n(0,"div",35)(1,"button",31),x("click",function(){_(t);let c=d(2);return g(c.toggleEdit())}),s(2,"Edit"),l()()}}function jt(e,m){if(e&1&&(n(0,"p",38),s(1),l()),e&2){let t=m.$implicit;o(),v(" * ",t," ")}}function Rt(e,m){if(e&1&&(n(0,"div",36),p(1,jt,2,1,"p",37),l()),e&2){let t=d(2);o(),a("ngForOf",t.errorMessages)}}function Nt(e,m){if(e&1){let t=h();n(0,"form",4),x("ngSubmit",function(){_(t);let c=d();return g(c.onSubmit())}),n(1,"mat-card-header")(2,"mat-card-title")(3,"div",5)(4,"button",6),x("click",function(){_(t);let c=d();return g(c.back())}),n(5,"mat-icon"),s(6,"arrow_back"),l(),n(7,"span",7),s(8,"back"),l()(),n(9,"textarea",8,0),s(11,"            "),l(),p(12,At,11,7,"div",9)(13,Mt,5,5,"div",10),l()()(),n(14,"div",11),p(15,Bt,1,5,"editor",12)(16,It,2,1,"div",13),n(17,"span",14),s(18),l(),p(19,Vt,9,3,"div",15),l(),n(20,"div"),p(21,Dt,3,0,"div",16)(22,Rt,2,1,"div",17),l()()}if(e&2){let t,i,c,r=d();a("formGroup",r.articleForm),o(9),a("appTogglablePlaceholder","Title")("maxLength",100)("hidden",!r.enableEditing),o(3),a("ngIf",!r.enableEditing),o(),a("ngIf",r.enableEditing),o(2),a("ngIf",r.enableEditing),o(),a("ngIf",!r.enableEditing),o(),a("ngClass",S(13,Et,r.enableEditing,!r.enableEditing)),o(),v(" ",(t=r.content==null||r.content.value==null?null:r.content.value.length)!==null&&t!==void 0?t:0," / 2048 "),o(),A(r.enableEditing?19:-1),o(2),a("ngIf",!r.enableEditing&&(!r.id||r.supabaseAuthService.user()&&(r.article.profiles==null?null:r.article.profiles.email)===((i=r.supabaseAuthService.user())==null?null:i.email))),o(),a("ngIf",(c=r.articleForm.get("title"))==null?null:c.invalid)}}var me=(()=>{class e{editor;articleService=u(vt);route=u(q);formBuilder=u(dt);matDialog=u(nt);router=u(U);snackBar=u(ht);sanitizer=u(G);cdRef=u(N);supabaseAuthService=u(gt);get article(){return this._article}set article(t){this.sanitizeHtml(t),this._article=t}_article={};enableEditing=!1;editorInitialized=!1;articleForm;init={plugins:"lists link image table code wordcount",navbar:!1,statusbar:!1,setup:t=>{t.on("init",()=>{setTimeout(()=>{this.editorInitialized=!0,this.cdRef.detectChanges()},250)})}};editorApiKey=_t.tinyMicApiKeys;errorMessages=[];id=+this.route.snapshot.params.id;get content(){return this.articleForm.get("content")}get title(){return this.articleForm.get("title")}ngOnInit(){this.enableEditing=this.route.snapshot.url.toString().includes("edit")||this.route.snapshot.url.toString().includes("new"),this.id=+this.route.snapshot.params.id,this.getArticle(!0)}initializeData(){return f(this,null,function*(){})}back(t=!1){return f(this,null,function*(){this.articleForm.dirty&&!t&&!(yield this.matDialog.open(b,{data:{title:"Unsaved changes",text:"Are you sure you want to leave this page?",confirmText:"Leave"}}).afterClosed().toPromise())||this.router.navigate(["/blog"])})}createForm(t={}){this.articleForm=this.formBuilder.group({title:[t?.title,E.required],content:[t?.content,E.required]})}getArticle(t=!1){return f(this,null,function*(){if(!this.id){this.createForm();return}let i=(yield this.articleService.get(this.id)).data?.[0];i&&(this.article=i??{},t&&this.createForm(i))})}sanitizeHtml(t){t.contentSafeHtml=this.sanitizer.bypassSecurityTrustHtml(t.content||"")}onDelete(){return f(this,null,function*(){(yield this.matDialog.open(b).afterClosed().toPromise())&&(yield this.articleService.delete(this.id),this.openSnackBar("Article deleted"),this.back(!0))})}onRestore(){return f(this,null,function*(){(yield this.matDialog.open(b,{data:{title:"Restore article",text:"Are you sure you want to restore this article?",confirmText:"Restore"}}).afterClosed().toPromise())&&(yield this.getArticle(!0),this.openSnackBar("Article restored"))})}openSnackBar(t){this.snackBar.open(t,"")}onSubmit(){return f(this,null,function*(){this.errorMessages=[],this.articleForm.get("title")?.patchValue(this.title?.value?.trim()),this.articleForm.get("content")?.patchValue(this.content?.value?.trim());let t=this.articleForm.errors;if(t&&(this.errorMessages=Object.keys(t).map(i=>t[i])),!this.articleForm.invalid){if(this.article.title=this.title?.value,this.article.content=this.content?.value,this.id)yield this.articleService.put(this.id,this.articleForm.value),this.openSnackBar("Article saved");else{let i=yield this.articleService.post(this.articleForm.value);i&&(this.id=i.data?.[0].id),this.router.navigate(["/blog/"+this.id+"/edit"]),this.openSnackBar("Article created")}this.articleForm.reset(this.articleForm.value)}})}toggleEdit(){this.articleForm.dirty&&(this.article=y(y({},this.articleForm.value),this.article)),this.enableEditing=!this.enableEditing}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=w({type:e,selectors:[["app-blog-article"]],viewQuery:function(i,c){if(i&1&&M(St,5),i&2){let r;B(r=I())&&(c.editor=r.first)}},standalone:!0,features:[V],decls:3,vars:2,consts:[["input",""],["editor",""],[1,"h-full",3,"appearance"],["class","flex flex-col h-full",3,"formGroup","ngSubmit",4,"ngIf"],[1,"flex","flex-col","h-full",3,"ngSubmit","formGroup"],[1,"flex","sm:flex-row","sm:items-center","items-start","flex-col","justify-between","flex-wrap"],["type","button","mat-icon-button","",1,"xs:mb-0","mb-2",3,"click"],[1,"sm:","hidden"],["type","text","matInput","","formControlName","title",1,"page-title","post-input","self-center","text-center","flex-1","text-3xl","font-light",3,"appTogglablePlaceholder","maxLength","hidden"],["class","flex-col flex-1 w-full",4,"ngIf"],["class","flex flex-col text-end items-end justify-between",4,"ngIf"],[1,"grow"],["formControlName","content",3,"ngClass","apiKey","init",4,"ngIf"],["class","content-text grow",3,"innerHTML",4,"ngIf"],[1,"self-end","text-xs","text-end","block","mb-6",3,"ngClass"],[1,"flex","sm:flex-row","flex-col-reverse","justify-between","gap-4","pt-4"],["class","flex justify-end pt-4",4,"ngIf"],["class","flex flex-col items-end justify-end pt-4",4,"ngIf"],[1,"flex-col","flex-1","w-full"],[1,"flex","page-title","justify-center","text-3xl","font-light"],[1,"flex","justify-end"],[1,"flex","gap-1","justify-end","items-center","text-xs","font-light"],[1,"flex","flex-col","text-end","items-end","justify-between"],[3,"ngClass"],[1,"self-end","text-xs","opacity-50"],["formControlName","content",3,"ngClass","apiKey","init"],[1,"content-text","grow",3,"innerHTML"],[1,"flex","sm:flex-row","flex-col-reverse","justify-start","gap-4"],["color","warn","mat-button","","type","button",3,"click",4,"ngIf"],["mat-button","","type","button",3,"disabled","click",4,"ngIf"],[1,"flex","sm:flex-row","flex-col-reverse","justify-end","gap-4"],["mat-button","","type","button",3,"click"],["mat-flat-button","",3,"disabled"],["color","warn","mat-button","","type","button",3,"click"],["mat-button","","type","button",3,"click","disabled"],[1,"flex","justify-end","pt-4"],[1,"flex","flex-col","items-end","justify-end","pt-4"],["class","color-error",4,"ngFor","ngForOf"],[1,"color-error"]],template:function(i,c){i&1&&(n(0,"mat-card",2)(1,"mat-card-content"),p(2,Nt,23,16,"form",3),l()()),i&2&&(a("appearance","outlined"),o(2),a("ngIf",c.articleForm&&c.article))},dependencies:[ft,ut,ct,ot,lt,at,W,$,J,Q,O,yt,bt,pt,st,mt,L,z,H,P,K,it,X,tt,et,Z,xt,rt,Y,Ct]})}return e})();export{me as BlogArticleEditComponent};
